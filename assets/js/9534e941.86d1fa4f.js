"use strict";(self.webpackChunk_clean_stack_source=self.webpackChunk_clean_stack_source||[]).push([[287],{7269:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"platform-features/observability/grafana-stack","title":"Grafana Stack Integration","description":"Clean Stack integrates with the Grafana observability stack (Grafana, Prometheus, Loki, and Tempo) to provide a complete observability solution.","source":"@site/docs/platform-features/observability/grafana-stack.md","sourceDirName":"platform-features/observability","slug":"/platform-features/observability/grafana-stack","permalink":"/docs/platform-features/observability/grafana-stack","draft":false,"unlisted":false,"editUrl":"https://github.com/ersanyamarya/clean-stack/tree/main/apps/clean-docs/docs/platform-features/observability/grafana-stack.md","tags":[],"version":"current","frontMatter":{"sidebar_label":"Grafana Integration"},"sidebar":"tutorialSidebar","previous":{"title":"OpenTelemetry Setup","permalink":"/docs/platform-features/observability/otel-clean-stack"},"next":{"title":"OpenTelemetry Exporters","permalink":"/docs/platform-features/observability/exporters"}}');var s=r(4848),t=r(8453);const a={sidebar_label:"Grafana Integration"},l="Grafana Stack Integration",c={},o=[{value:"Stack Overview",id:"stack-overview",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Pre-configured Dashboards",id:"pre-configured-dashboards",level:2},{value:"1. Service Overview",id:"1-service-overview",level:3},{value:"2. Distributed Tracing",id:"2-distributed-tracing",level:3},{value:"3. Log Analytics",id:"3-log-analytics",level:3},{value:"Custom Dashboard Creation",id:"custom-dashboard-creation",level:2},{value:"1. Metrics Dashboard",id:"1-metrics-dashboard",level:3},{value:"2. Trace Analysis",id:"2-trace-analysis",level:3},{value:"3. Log Queries",id:"3-log-queries",level:3},{value:"Alert Configuration",id:"alert-configuration",level:2},{value:"1. High Latency Alert",id:"1-high-latency-alert",level:3},{value:"2. Error Rate Alert",id:"2-error-rate-alert",level:3},{value:"Data Retention",id:"data-retention",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Security Considerations",id:"security-considerations",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"grafana-stack-integration",children:"Grafana Stack Integration"})}),"\n",(0,s.jsx)(n.p,{children:"Clean Stack integrates with the Grafana observability stack (Grafana, Prometheus, Loki, and Tempo) to provide a complete observability solution."}),"\n",(0,s.jsx)(n.h2,{id:"stack-overview",children:"Stack Overview"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph TD\n    A[Your Application] --\x3e B[OpenTelemetry Collector]\n    B --\x3e C[Prometheus]\n    B --\x3e D[Loki]\n    B --\x3e E[Tempo]\n    C --\x3e F[Grafana]\n    D --\x3e F\n    E --\x3e F\n    style F fill:#F46800,stroke:#333,stroke-width:2px"}),"\n",(0,s.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Start the observability stack:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"bun run platform:observability\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Access Grafana:"}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["URL: ",(0,s.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"})]}),"\n",(0,s.jsxs)(n.li,{children:["Default credentials:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Username: admin"}),"\n",(0,s.jsx)(n.li,{children:"Password: admin"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"pre-configured-dashboards",children:"Pre-configured Dashboards"}),"\n",(0,s.jsx)(n.h3,{id:"1-service-overview",children:"1. Service Overview"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Request rates and latencies"}),"\n",(0,s.jsx)(n.li,{children:"Error rates"}),"\n",(0,s.jsx)(n.li,{children:"Resource usage"}),"\n",(0,s.jsx)(n.li,{children:"Cache performance"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-distributed-tracing",children:"2. Distributed Tracing"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"End-to-end request flows"}),"\n",(0,s.jsx)(n.li,{children:"Service dependencies"}),"\n",(0,s.jsx)(n.li,{children:"Performance bottlenecks"}),"\n",(0,s.jsx)(n.li,{children:"Error analysis"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-log-analytics",children:"3. Log Analytics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Structured log search"}),"\n",(0,s.jsx)(n.li,{children:"Log correlation"}),"\n",(0,s.jsx)(n.li,{children:"Pattern analysis"}),"\n",(0,s.jsx)(n.li,{children:"Alert configuration"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"custom-dashboard-creation",children:"Custom Dashboard Creation"}),"\n",(0,s.jsx)(n.h3,{id:"1-metrics-dashboard",children:"1. Metrics Dashboard"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Define custom metrics\nconst requestDuration = metrics.createHistogram('http_request_duration', {\n  description: 'HTTP request duration',\n  unit: 'ms',\n  boundaries: [10, 50, 100, 200, 500, 1000]\n});\n\n// Use in your code\napp.use(async (ctx, next) => {\n  const startTime = Date.now();\n  try {\n    await next();\n  } finally {\n    const duration = Date.now() - startTime;\n    requestDuration.record(duration, {\n      path: ctx.path,\n      method: ctx.method,\n      status: ctx.status\n    });\n  }\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then in Grafana:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Add new panel"}),"\n",(0,s.jsxs)(n.li,{children:["Query: ",(0,s.jsx)(n.code,{children:"rate(http_request_duration_bucket[5m])"})]}),"\n",(0,s.jsx)(n.li,{children:"Visualization: Heatmap"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-trace-analysis",children:"2. Trace Analysis"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Add custom attributes to spans\nconst span = tracer.startSpan('process-order');\nspan.setAttribute('order.id', orderId);\nspan.setAttribute('customer.type', customerType);\nspan.setAttribute('order.value', orderValue);\n"})}),"\n",(0,s.jsx)(n.p,{children:"In Grafana Tempo:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Search by attribute"}),"\n",(0,s.jsx)(n.li,{children:"Create Service Graph"}),"\n",(0,s.jsx)(n.li,{children:"Analyze Flame Graph"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-log-queries",children:"3. Log Queries"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Structured logging\nlogger.info('Order processed', {\n  orderId: 'order-123',\n  processingTime: 150,\n  customerTier: 'premium'\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"In Grafana Loki:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-logql",children:'{service="order-service"} \n  | json\n  | processingTime > 100\n  | customerTier="premium"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"alert-configuration",children:"Alert Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"1-high-latency-alert",children:"1. High Latency Alert"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# In Grafana UI:\nalert:\n  name: High Service Latency\n  condition: avg_over_time(http_request_duration_seconds[5m]) > 0.5\n  for: 5m\n  labels:\n    severity: warning\n  annotations:\n    summary: Service experiencing high latency\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-error-rate-alert",children:"2. Error Rate Alert"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'alert:\n  name: High Error Rate\n  condition: |\n    sum(rate(http_requests_total{status=~"5.."}[5m])) \n    / \n    sum(rate(http_requests_total[5m])) > 0.05\n  for: 5m\n  labels:\n    severity: critical\n'})}),"\n",(0,s.jsx)(n.h2,{id:"data-retention",children:"Data Retention"}),"\n",(0,s.jsx)(n.p,{children:"Default retention periods:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Metrics (Prometheus): 15 days"}),"\n",(0,s.jsx)(n.li,{children:"Logs (Loki): 7 days"}),"\n",(0,s.jsx)(n.li,{children:"Traces (Tempo): 3 days"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Configure in docker-compose:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"prometheus:\n  command:\n    - '--storage.tsdb.retention.time=30d'\n\nloki:\n  config:\n    table_manager:\n      retention_period: 168h\n\ntempo:\n  retention_period: 72h\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Dashboard Organization"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use folders for different teams/services"}),"\n",(0,s.jsx)(n.li,{children:"Standardize naming conventions"}),"\n",(0,s.jsx)(n.li,{children:"Include documentation panels"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Query Optimization"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use recording rules for complex queries"}),"\n",(0,s.jsx)(n.li,{children:"Limit high-cardinality labels"}),"\n",(0,s.jsx)(n.li,{children:"Set appropriate time ranges"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Alert Management"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Define clear severity levels"}),"\n",(0,s.jsx)(n.li,{children:"Include runbooks in alerts"}),"\n",(0,s.jsx)(n.li,{children:"Configure proper notification channels"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Missing Data"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Check collector connectivity"}),"\n",(0,s.jsx)(n.li,{children:"Verify port configurations"}),"\n",(0,s.jsx)(n.li,{children:"Ensure correct label matching"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Dashboard Performance"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Optimize time ranges"}),"\n",(0,s.jsx)(n.li,{children:"Use appropriate refresh intervals"}),"\n",(0,s.jsx)(n.li,{children:"Minimize panel count"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Alert Issues"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Validate alert conditions"}),"\n",(0,s.jsx)(n.li,{children:"Check notification settings"}),"\n",(0,s.jsx)(n.li,{children:"Review alert history"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Access Control"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'grafana:\n  env:\n    GF_AUTH_DISABLE_LOGIN_FORM: "false"\n    GF_AUTH_ANONYMOUS_ENABLED: "false"\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Network Security"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use TLS for data transmission"}),"\n",(0,s.jsx)(n.li,{children:"Implement proper authentication"}),"\n",(0,s.jsx)(n.li,{children:"Restrict network access"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Data Protection"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Configure data retention"}),"\n",(0,s.jsx)(n.li,{children:"Implement log sanitization"}),"\n",(0,s.jsx)(n.li,{children:"Manage sensitive labels"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>l});var i=r(6540);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);